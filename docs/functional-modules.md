# 功能模块分析

## 模块概览

rust-find 项目采用模块化设计，将不同的功能划分为独立的模块，便于维护和扩展。主要模块包括：

1. **CLI 模块** - 处理命令行参数解析和验证
2. **Finder 模块** - 核心查找功能实现
3. **Filter 模块** - 文件过滤功能
4. **Walker 模块** - 文件系统遍历功能
5. **Options 模块** - 查找选项配置
6. **Thread Pool 模块** - 自适应线程池管理
7. **Errors 模块** - 错误处理和自定义错误类型

## CLI 模块

### 功能描述

CLI 模块负责解析命令行参数并验证其有效性。它使用 `clap` 库来定义和解析命令行接口。

### 主要特性

- 支持多种命令行参数和选项
- 参数验证和错误提示
- 与查找选项的映射

### 重要参数

- `paths` - 搜索路径列表
- `--max-depth` - 最大搜索深度
- `--name`/`--iname` - 文件名模式匹配（区分/不区分大小写）
- `--follow-links` - 是否跟随符号链接
- `--absolute`/`--relative` - 路径格式控制
- `--parallel` - 并行搜索开关
- 线程池配置选项

## Finder 模块

### 功能描述

Finder 模块是项目的核心，负责执行实际的文件查找任务。它协调其他模块的工作，提供串行和并行两种查找模式。

### 主要组件

1. **Finder 结构体** - 主要的查找器接口
2. **查找选项** - 配置查找行为的参数
3. **查找执行函数** - 实际执行查找的函数

### 工作流程

1. 初始化查找选项
2. 创建过滤器
3. 执行文件系统遍历
4. 应用过滤器筛选结果
5. 返回匹配的文件路径

## Filter 模块

### 功能描述

Filter 模块提供多种文件过滤功能，允许用户根据不同的条件筛选文件。

### 过滤器类型

1. **NameFilter** - 文件名模式匹配过滤器
2. **MultiNameFilter** - 多模式文件名过滤器
3. **TypeFilter** - 文件类型过滤器
4. **PathFormatFilter** - 路径格式过滤器

### 特性

- 支持 glob 模式匹配
- 大小写敏感/不敏感匹配
- 多模式组合（AND/OR 逻辑）
- 文件类型过滤（文件、目录、符号链接）

## Walker 模块

### 功能描述

Walker 模块负责遍历文件系统，收集目录条目。它基于 `walkdir` 库实现，并提供了额外的错误处理和选项支持。

### 主要组件

1. **FileWalker** - 文件系统遍历器
2. **FileWalkerIterator** - 基于迭代器的遍历器

### 特性

- 递归遍历目录结构
- 深度控制
- 符号链接处理
- 错误处理和忽略选项

## Options 模块

### 功能描述

Options 模块定义了查找过程的配置选项，控制查找行为的各个方面。

### 配置选项

- `max_depth` - 最大搜索深度
- `follow_links` - 是否跟随符号链接
- `ignore_permission_errors` - 是否忽略权限错误
- `ignore_io_errors` - 是否忽略 I/O 错误
- `ignore_hidden` - 是否忽略隐藏文件
- 线程池配置选项

## Thread Pool 模块

### 功能描述

Thread Pool 模块提供自适应线程池功能，根据系统资源和工作负载动态调整线程数量。

### 主要组件

1. **AdaptiveThreadPool** - 自适应线程池
2. **ThreadPoolConfig** - 线程池配置

### 特性

- 动态调整线程数量
- 基于目录数量的线程分配
- 最小/最大线程数限制
- 自动调整开关

## Errors 模块

### 功能描述

Errors 模块定义了项目的自定义错误类型，提供详细的错误信息和上下文。

### 错误类型

- `FileNotFound` - 文件未找到
- `PermissionDenied` - 权限不足
- `FilesystemError` - 文件系统错误
- `PatternError` - 模式匹配错误
- `WalkDirError` - 目录遍历错误